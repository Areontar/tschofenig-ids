



ace                                                          A. Somaraju
Internet-Draft                                     Tridonic GmbH & Co KG
Intended status: Standards Track                                S. Kumar
Expires: January 1, 2016                                Philips Research
                                                           H. Tschofenig
                                                                ARM Ltd.
                                                           June 30, 2015


               Multicast Security for the Lighting Domain
                  draft-somaraju-ace-multicast-00.txt

Abstract

   TBD.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at http://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on January 1, 2016.

Copyright Notice

   Copyright (c) 2015 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (http://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.




Somaraju, et al.         Expires January 1, 2016                [Page 1]

Internet-Draft Multicast Security for the Lighting Domain      June 2015


Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
   2.  Terminology . . . . . . . . . . . . . . . . . . . . . . . . .   7
   3.  The Access Level Concept  . . . . . . . . . . . . . . . . . .   8
   4.  Access Token Format . . . . . . . . . . . . . . . . . . . . .   8
   5.  Lighting application example  . . . . . . . . . . . . . . . .  12
     5.1.  Unicast Messages using the LWM2M Object Model . . . . . .  12
     5.2.  Multicast Communication using the LWM2M Object Model  . .  14
   6.  Security Considerations . . . . . . . . . . . . . . . . . . .  18
     6.1.  Token Verification  . . . . . . . . . . . . . . . . . . .  18
     6.2.  Token Revocation  . . . . . . . . . . . . . . . . . . . .  18
     6.3.  Time  . . . . . . . . . . . . . . . . . . . . . . . . . .  18
   7.  Operational Considerations  . . . . . . . . . . . . . . . . .  19
     7.1.  Persistence of State Information  . . . . . . . . . . . .  19
     7.2.  Provisioning in Small Networks  . . . . . . . . . . . . .  19
   8.  Acknowledgements  . . . . . . . . . . . . . . . . . . . . . .  19
   9.  References  . . . . . . . . . . . . . . . . . . . . . . . . .  19
     9.1.  Normative References  . . . . . . . . . . . . . . . . . .  19
     9.2.  Informative References  . . . . . . . . . . . . . . . . .  20
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  20

1.  Introduction

   There are several lighting related use cases that require securing
   the communication between a sender and a group of receivers where a
   message needs to be received.

   For such applications, two problems need to be addressed:

   1.  Only authorized members of the multicast group must read and
       process messages.

   2.  Message transfer and processing must happen with low latency
       (typically 200 ms).

   This document discusses these two issues and describes how these
   issues could be addressed.

   Typically, multiple lighting nodes (incl. sensors, switches,
   luminaires etc.) are grouped into a single lighting application
   group.  Each node in the group might be a sender, a receiver or both
   sender and receiver within the group (even though in the figures
   below, we show nodes that are only senders or receivers for clarity).
   Every sender in the group needs to be authorized to send a message
   (with low latency) to all the receivers within that application
   group.  Receivers in the group process the message after verifying
   the included access token, which encapsulates the capabilities given



Somaraju, et al.         Expires January 1, 2016                [Page 2]

Internet-Draft Multicast Security for the Lighting Domain      June 2015


   to the sender.  On some occasions, a sender in a group will be
   required to send unicast messages to unique receivers within the same
   group and the authorization procedure must also ensure security for
   such communications.

   Figure 1 and Figure 2 provide an architectural overview.  Figure 1
   illustrates the information flow between an authorization server and
   the participating nodes.  This step is typically executed during the
   commissioning phase for nodes that are statically mounted in
   buildings.  The authorization server is a logical function that may,
   however, be included in a device carried by the commissioner.  In
   other situations, the authorization decisions change often or
   dynamically, as it would be the case with employees using their
   smartphones to control lights.

   In any case, the described architecture envisions a separation
   between the authorization server providing authorization and
   configuration information to all nodes in the network and the Key
   Distribution Center (KDC) that is responsible to distributing group
   keying material to support both the static and the dynamic model.  In
   a static model, the authorization is a one time process during the
   commissioning and the authorization server can be removed while still
   allowing key updates using the KDC.  In the dynamic model, the
   authorization server and KDC continue to be available online during
   the operational phase, often both the logical functions physically on
   a same device.

   As a result of the initial interaction described in Figure 1 network
   nodes are configured with an proof-of-possession (PoP) access token
   for use with the KDC and the corresponding key associated with that
   access token.  The token and the key is subsequently used with the
   KDC when requesting group keys, as described in Figure 2.



















Somaraju, et al.         Expires January 1, 2016                [Page 3]

Internet-Draft Multicast Security for the Lighting Domain      June 2015


                                   +------------+
                                   |    Key     |
                                +--|Distribution|
                                |  |   Center   |
                             Key|  +------------+
                                |
                                |
           C-Data       +-------------+        C-Data
            +-----------+Authorization+------------+
            | .........>|   Server    |<.......... |
            | .  DTLS   +-------------+   DTLS   . |
            | .                                  . |
            | .                                  . |
            | .                                  . |
            v v                                  v v
         +-----+                               +-----+
        +-----+|                              +-----+|
       +-----+|+                             +-----+|+
       |  A  |+                              |  B  |+
       +-----+                               +-----+
       Sender(s)                            Receiver(s)
    e.g. Light Switch                    e.g. Luminaries

   Legend:

   C-Data (Configuration Data) includes configuration parameters,
   authorization information encapsulated inside an proof-of-possesion
   access token (AT-KDC) and long-term key.




               Figure 1: Architecture: Commissioning Phase.


















Somaraju, et al.         Expires January 1, 2016                [Page 4]

Internet-Draft Multicast Security for the Lighting Domain      June 2015


                        +------------+
    AT-R                |    Key     |        Revocation
   +Group  +------------|Distribution|-------------+
     Key   | ..........>|   Center   |<........... |
           | .  DTLS    +------------+    DTLS   . |
           | .                                   . |
           | .                                   . |
           | .                                   . |
           v v                                   v v
        +-----+                                +-----+
       +-----+|                               +-----+|
      +-----+|+       Multicast mesg         +-----+|+
      |  A  |+-----------------------------> |  B  |+
      +-----+............DTLS..............> +-----+
      Sender(s)                            Receiver(s)
   e.g. Light Switch                    e.g. Luminaries


                Figure 2: Architecture: Operational Phase.

   The dotted lines in Figure 1 and Figure 2 illustrate the use of DTLS
   for securing the message exchange between all involved parties.  This
   document assumes that the credentials used to authenticate network
   nodes to the authorization server have been pre-provisioned.

   Prior to the protocol interaction the resource owner specifies
   authorization policies within the authorization server that define
   which network node is allowed to perform which actions.

   The steps during the commission phase are as follows:

      All nodes contact an authorization server.  This step happens
      during the commissioning process or, dynamically for those cases
      where authorization decisions changes over time (such as with
      smartphones or tablets).  This interaction is secured and the
      endpoints are authenticated.

      The authorization server evaluates the request and determines what
      access level the requester can be granted.  Finally, configuration
      information, a proof-of-possession (PoP) access token and the key
      bound to that token from the authorization server is provided to
      the requester.  The PoP access token (AT) is meant for use with
      the Key Distribution Center (KDC).  It is labelled as AT-KDC.

   Figure 3 describes the algorithm for obtaining the necessary
   credentials to transmit a secure multicast message based on the
   architectural description shown in Figure 2.  When sender wants to
   send a message to the application group, it checks if it has the



Somaraju, et al.         Expires January 1, 2016                [Page 5]

Internet-Draft Multicast Security for the Lighting Domain      June 2015


   group key If no group key is available then it checks if it has an
   access token for use with the KDC (AT-KDC).  If no AT-KDC is found
   then it contacts the authorization server to obtain an access token.
   Note that this assumes that the authorization server is online, which
   is only true in scenarios where granting authorization dynamically is
   supported.  In the other case where the AT-KDC is already available
   the sender contacts the KDC to obtain a group key.  If a group key is
   already available then the sender can transmit a message secured to
   the group immediately.


                                     _______
                                    /       \
                                    | Start |
                                    \_______/
                                        |
                                        v
                                       /\
                                      /  \
                                     /    \
                                    /      \
                                   /        \
                         ___No____/Group Key \____
                        |         \Available?/    |
                        |          \        /     |
                        v           \      /     Yes
                       /\            \    /       |
                      /  \            \  /        v
                     /    \            \/   +-------------+
                    /      \            ^   |Transmit     |
                   /        \           |   |multicast    |
              ____/  AT+KDC  \__        |   |mesg to group|
             |    \Available?/  |       |   +-------------+
             |     \        /   |       |
            No      \      /   Yes      |
             |       \    /     |       |
             |        \  /      |       |
             v         \/       v       |
       +-----+-----+   ^  +----------+  |
       |Request    |   |  |Request   |  |
       |AT-KDC     |   |  |Group Key |  |
       |from       |---+  |from KDC  |--+
       |Auth Server|      |          |
       +-----------+      +----------+


              Figure 3: Steps to Transmit Multicast Message.




Somaraju, et al.         Expires January 1, 2016                [Page 6]

Internet-Draft Multicast Security for the Lighting Domain      June 2015


   Note that the sender does not have to wait until it has to transmit a
   message in order to request a group key; the sender is likely to be
   pre-configured with information about which lighting application
   group it belongs to and can therefore pre-fetch the required
   information.

   Group keys have a lifetime, which is configuration dependent, but
   mechanisms need to be provided to update the group keys either via
   the sender asking for a group key renewal or via the KDC pushing new
   keys to senders and receivers.  The lifetime can be based on time or
   on the number of transmitted messages.

   In the simplified message exchange the sender obtains a group key and
   starts communicating with receivers in that group using secure
   multicast.  The receivers on their side need to perform two important
   steps, namely the receivers themselves need to obtain the necessary
   group key to verify the incoming messages and, receivers also need
   information about what the specific sender is authorized to access.

   Authorization information as well as the group key is conveyed within
   an access token, which is provided by the sender to the receivers in
   the initial multicast message.  The authorization information
   includes details about the authorized access level as granted by the
   authorization server as well as information about the more fine
   grained access, for example the group the sender is permitted to send
   messages to.

   Multicast messages need to be protected such that replay and
   modification can be detected.  The integrity of the message is
   protected using a group key.  The use of symmetric keys is envisioned
   here due to latency requirements and level of security required for
   these messages as described in Section 3.  For secure unicast
   messaging, a topic outside the scope of this document, the sender is
   assumed to use the DTLS handshake to establish the necessary security
   context for securing subsequent message interactions.

2.  Terminology

   This document the following terms from [I-D.gerdes-ace-actors]:
   Authorization Server, Resource Owner, Client, Resource Server.  The
   term 'sender' corresponds to client and the term 'receiver'
   corresponds to Resource Server from [I-D.gerdes-ace-actors].

   This document also assumes that the reader is familiar with the OMA
   Lightweight Machine-to-Machine (LWM2M) specifications [LWM2M] and the
   IPSO specification [IPSO].





Somaraju, et al.         Expires January 1, 2016                [Page 7]

Internet-Draft Multicast Security for the Lighting Domain      June 2015


3.  The Access Level Concept

   A characteristic of the lighting domain is that access control
   decisions are also impacted by the type of operation being performed
   and those categories are listed below.  The following access levels
   are pre-defined.

   Level 0: Service detection only

      This is a service that is used with broadcast service detection
      methods.  No operational data is accessible at this level.

   Level 1: Reporting only

      This level allows access to sensor and other (relatively
      uncritical) operational data and the device error status.  The
      operation of the system cannot be influenced using this level.

   Level 2: Standard use

      This level allows access to all operational features, including
      access to operational parameters.  This is the highest level of
      access that can be obtained using (secure) multicast.

   Level 3: Commissioning use / Parametrization Services

      This level gives access to certain parameters that change the day-
      to-day operation of the system, but does not allow structural
      changes.

   Level 4: Commissioning use / Localization and Addressing Services

      (including Factory Reset) This level allows access to all services
      and parameters including structural settings.

   Level 5: Software Update and related Services

      This level allows the change and upgrade of the software of the
      devices.

   Note: The use of (secure) multicast communication is disallowed for
   level higher than Level 2.

4.  Access Token Format

   This document assumes the use of access tokens to pass authorization
   information as well as keying material between the different parties
   in the lighting domain.  To improve interoperability a token format



Somaraju, et al.         Expires January 1, 2016                [Page 8]

Internet-Draft Multicast Security for the Lighting Domain      June 2015


   needs to be standardized and this section outlines the use of an
   existing format based on the JSON Web Token (JWT).  It contains a
   symmetric key encapsulated inside the JSON Web Key (JWK).  The
   capabilities, called claims in the JWT jargon, are included inside
   the token and, in this example, state that the granted access level
   is 2 and access to the application group 2 is allowed by the sender.

   The example below shows an access token using the standardized JWT
   format with an embedded symmetric key.  While JSON is a compact
   encoding format, standardization work is ongoing to define an even
   more efficient format for conveying the same information using a
   binary format (using CBOR as defined in RFC 7049 [RFC7049]).  The
   corresponding security protection is currently being defined in the
   IETF COSE working group [COSE].

   JSON Web Token (JWT) protected using a JSON Web Signature (JWS)
   applying a message authentication code to protect against forgery.
   The actual signature computation (and the result) is omitted in this
   example.


   JWS Header:

       {"alg":"HS256",
        "kid":"123"
       }

   Legend for JWS Header:
   - alg: Algorithm parameter indicating the type of cryptographic
          algorithm used to protect the structure. In this case
          HMAC-SHA 256 is used.
   - kid: Key Identifier used to select the appropriate key.



















Somaraju, et al.         Expires January 1, 2016                [Page 9]

Internet-Draft Multicast Security for the Lighting Domain      June 2015


 JWT Body:
    {
       "iss": "coaps://as.example.com",
       "exp": "1361398824",
       "scp": "l2,g2",
       "cnf":{
         "jwe":
           "eyJhbGciOiJSU0ExXzUiLCJlbmMiOiJBMTI4Q0JDLUhTMjU2IiwiY3R5Ijoi
            andrK2pzb24ifQ. ... (remainder of JWE omitted for brevity)"
         }
      }

 Legend for JWT Body:
 - iss: Issuer (which is the entity creating the access token). The
        content does not need to be a URI but can also be a string
        identifying the entity issuing the token.
 - exp: Expiry date of the access token. Claim can be omitted if
        tokens do not expire (for example, in a small enterprise
        environment).
 - scp: Scope denoting the capabilities of the token
 - cnf: Key confirmation element containing an encrypted JSON Web
        Key. The encryption being applied uses JSON Web
        Encryption (JWE).


   The JSON Web Encryption (JWE) contains a header followed by the
   content that is encrypted.  Details about the JWE usage relevant for
   this example can be found in Appendix A.3 of RFC 7516 [RFC7516].


   JWE Header:

   {"alg":"A128KW",
    "enc":
    "A128CBC-HS256"
   }

   Legend for JWE Header:
   - alg: Algorithm parameter indicating the AES 128 Key Wrap algorithm
          being used for encrypting the included key and the
          AES_128_CBC_HMAC_SHA_256 algorithm is used for authenticated
          encryption.









Somaraju, et al.         Expires January 1, 2016               [Page 10]

Internet-Draft Multicast Security for the Lighting Domain      June 2015


   JWE Header:

   {"alg":"A128KW",
    "enc":
    "A128CBC-HS256"
   }

   Legend for JWE Header:
   - alg: Algorithm parameter indicating the AES 128 Key Wrap algorithm
          being used for encrypting the included key and the
          AES_128_CBC_HMAC_SHA_256 algorithm is used for authenticated
          encryption.



   JWE Header:

   {"alg":"A128KW",
    "enc":
    "A128CBC-HS256"
   }

   Legend for JWE Header:
   - alg: Algorithm parameter indicating the AES 128 Key Wrap algorithm
          being used for encrypting the included key and the
          AES_128_CBC_HMAC_SHA_256 algorithm is used for authenticated
          encryption.



JWK to be encrypted by JWE:

 {"kty":"oct",
  "k":"GawgguFyGrWKav7AX4VKUg"
 }

Legend for the JWK to be encrypted:
- kty: Key type identifies the cryptographic algorithm family used with
       the key. In this example the JWK contains a symmetric key denoted
       as "oct" for octet sequence.
- k: Key parameter containing the actual key.










Somaraju, et al.         Expires January 1, 2016               [Page 11]

Internet-Draft Multicast Security for the Lighting Domain      June 2015


5.  Lighting application example

   In this Section, we look at a typical lighting application in which
   presence sensor(s) are used to actuate a group of light points via a
   control function based on a pre-specified set of rules.  The
   CoAP/LWMM2M/IPSO protocol stack can be used as a foundation for the
   design of a lighting system.  The architecture identifies three
   functions present in a lighting system:

   o  Sensor functions which detect a (physical) phenomenon like a light
      sensor, a presence detector or a push button.

   o  Actuator functions which cause action or change like setting a
      driver value of a light source.

   o  Control functions which link the inputs (from sensor functions) to
      outputs (from actuator functions) and enforce specific behaviour.

   In typical applications, a sensor output might be used by multiple
   control functions and a single control function might control many
   actuators and a single actuator may be controlled by multiple control
   functions.  Moreover, different functions (e.g. control and actuator)
   might be collocated on a single device.  In the example below, we
   show one method that may be used to implement the above architecture
   using the LWM2M object model.  We begin with the case of unicast
   communication (because the LWM2M model does not directly support
   multicast communication).  We then explain a possible way to extend
   to the multicast situation.

5.1.  Unicast Messages using the LWM2M Object Model

   The unicast scenario considers a deployment with a single (physical)
   presence sensor, a single (physical) luminaire and the desired
   control functionality is the following: dim the luminaire to 90% when
   presence is detected in the room and dim the luminaire to 10% when
   there is no presence.  In this situation, the sensor functionality is
   implemented on the presence sensor, the actuator functionality is
   implemented on the luminaire and the control functionality could be
   implemented on the presence sensor or the luminaire or on an
   independent physical control device.

   Using the LWM2M object model,

   o  the presence sensor function is implemented using the IPSO
      Presence object with Object ID 3302 [1].

   o  the actuator control function is implemented using the IPSO Light
      control object with Object ID 3311 [1].



Somaraju, et al.         Expires January 1, 2016               [Page 12]

Internet-Draft Multicast Security for the Lighting Domain      June 2015


   o  the control function is implemented by a LWM2M server to which the
      two LWM2M clients on the luminaire and presence sensor register.

   The IPSO Light Control Object supports the "Dimmer" resource (Res ID
   5851) which may be written to in order to change the light intensity
   output.  The IPSO Presence Object supports the "Digital Input State"
   resource (Res ID 5500) which is a boolean readable resource that
   reflects the current state of the presence sensor.  A method to
   implement the control functionality is the following:

   1.  The luminaire and the presence sensor register their objects with
       the control LWM2M server.  This registration step happens during
       commissioning phase, when the device reboots or whenever IP
       addresses change.

   2.  The control LWM2M server observes the "Digital Input State" of
       the presence sensor.

   3.  When the presence sensor state changes, the sensor notifies the
       control LWM2M server.

   4.  The control LWM2M server writes the correct output intensity to
       the "Dimmer" resource to change the luminaire light output.

   This sequence of messages is shown in Figure 4.  Here, [IP_C], [IP_L]
   and [IP_S] are the unicast IP addresses of the devices that implement
   the control function, light control object and sensor object,
   respectively.























Somaraju, et al.         Expires January 1, 2016               [Page 13]

Internet-Draft Multicast Security for the Lighting Domain      June 2015


   +---------------+    +--------------+     +--------------+
   |Presence Sensor|    | Control Unit |     |  Luminaire   |
   |(LWM2M client) |    |(LWM2M server)|     |(LWM2M client)|
   +---------------+    +--------------+     +--------------+
          |                     |                      |
          |  [IP_C]Register     |    [IP_C]Register    |
          |-------------------->|<---------------------|
          |     </3302/0>       |      </3311/0>       |
          |                     |                      |
          |  [IP_S]2.01 Created | [IP_L]2.01 Created   |
          |<--------------------|--------------------->|
          |                     |                      |
          |[IP_S]GET            |                      |
          |<--------------------|                      |
          |    /3302/0/5500 Obs.|                      |
          |                     |                      |
          |[IP_C]2.05 Content   |                      |
          |-------------------->|[IP_L]PUT /3311/0/5851|
          |     Obs. FALSE      |--------------------->|
          |                     |         10           |
          |   [IP_C]Notify      |                      |
          |-------------------->|[IP_L]PUT /3311/0/5851|
          |      TRUE           |--------------------->|
          |                     |         90           |
          |   [IP_C]Notify      |                      |
          |-------------------->|[IP_L]PUT /3311/0/5851|
          |       FALSE         |--------------------->|
          |                     |         10           |

      Figure 4: Unicast messaging between control unit and luminaire.

5.2.  Multicast Communication using the LWM2M Object Model

   We now see how the above unicast model may be extended to the group
   communication case and explain the security implications of the group
   communication case.  There are three types of groups that we need to
   consider:

   Application Group:

      A lighting application group that consists of the set of all
      lighting devices that have been configured by a commissioner to
      respond to events in a consistent manner.  For instance, a wall
      mounted switch and a set of luminaires in a single room might
      belong to a single group and the switch may be used to turn on/off
      all the luminaires in the group simultaneously with a single
      button press.  In the remainder of this document we will use GId
      to identify an application group.



Somaraju, et al.         Expires January 1, 2016               [Page 14]

Internet-Draft Multicast Security for the Lighting Domain      June 2015


   Multicast Group:

      A multicast group consists of the set of all nodes that subscribe
      to the same multicast IP address.

   Security Group:

      A security group consists of a set of sending and receiving nodes
      such that any sending node is able to securely send a message to
      all the receiving nodes.  For instance, if symmetric keys are used
      to secure such messages then every node that has access to the
      symmetric key is a part of the security group.  Should every node
      in a security group decrypt a message even if it is not for it
      because it is not for its application group.

   Typically, the three groups might not coincide due to the memory
   constraints on the devices and also security considerations.  For
   instance, in a small room with windows, we may have three application
   groups: "room group", "luminaires close to the window group" and
   "luminaires far from the window group".  However, we may choose to
   use only one multicast group for all devices in the room and one
   security group for all the devices in the room.

   Let us now look at a typical lighting application that requires group
   communication: 1) A set of rooms are attached to a single corridor;
   2) Each room consists of 8 luminaires with 4 luminaires close to a
   window and four luminaires close to a wall; 3) Every room has a
   presence sensor and the corridor also has a presence sensor. 4) Every
   room has an individual control function that maybe implemented on the
   room presence sensor device, one of the luminaries or an independent
   control device.

   The control functionality we wish to implement is the following:

   o  If presence is detected in the room, then dim-up the wall
      luminaires to 90% and window luminaires to 50%.

   o  If no presence is detected in the room or corridor, then turn off
      all luminaires.

   o  If no presence is detected in the room but presence is detected in
      the corridor, then turn all the luminaires to 10% (for all rooms
      attached to corridor).

   For multicast communication, we can not use the LWM2M model directly.
   However, we can make the following assumptions:





Somaraju, et al.         Expires January 1, 2016               [Page 15]

Internet-Draft Multicast Security for the Lighting Domain      June 2015


   o  All luminaires are CoAP servers whose resource tree supports the
      IPSO Light Control object.

   o  All presence sensors are CoAP servers whose resource tree supports
      the IPSO Presence Object.

   o  The control function is implemented using a CoAP client.

   o  All devices in the nth room subscribe to the multicast address
      [IP_M_Rn] and the device that implements the control function in
      this room has unicast address [IP_Cn].

   o  Every room has three groups: "room group" (GId = 0), "window
      group" (GId = 1), "wall group" (GId = 2).

   o  The GId is carried as a CoAP header (query?) option.


+--------------+
|  Luminaire   |
|(CoAP Server) |
+--------------+
 ||| +---------------+       +---------------+
 ||| |Presence Sensor|       |Presense Sensor|          +--------------+
 ||| |Corridor       |       |Room           |          | Control Unit||
 ||| |(CoAP Server)  |       |(CoAP Server)  |          | (CoAP Client)|
 ||| +---------------+       +---------------+          +--------------+
 |||        |                         |                             |||
 |||        |            [IP_SC]GET /3302/0/5500 Obs.               |||
 |||        |<------------------------------------------------------|||
 |||        |                         |                             |||
 |||        |              [IP_C1] 2.05 Content Obs.                |||
 |||        |------------------------------------------------------>|||
 |||        |                       FALSE                           |||
 |||        |                         |                             |||
 |||        |                         |[IP_SR]GET /3302/0/5500 Obs. |||
 |||        |                         |<----------------------------|||
 |||        |                         |                             |||
 |||        |                         |  [IP_C1] 2.05 Content Obs.  |||
 |||        |                         |---------------------------->|||
 |||        |                         |           FALSE             |||
 |||        |                         |                             |||
 |||        |                         |                             |||
 |||        |                  [IP_C1] Notify                       |||
 |||        |------------------------------------------------------>|||
 |||        |                       TRUE                            |||
 |||        |                         |                             |||
 |||        |       [IP_M_R1]PUT /3311/0/5851 ?gp=0                 |||



Somaraju, et al.         Expires January 1, 2016               [Page 16]

Internet-Draft Multicast Security for the Lighting Domain      June 2015


 |||<---------------------------------------------------------------+||
 |||        |                     10  |                             |||
 |||        |                         |                             |||
 |||        |                         |      [IP_C1] Notify         |||
 |||        |                         |---------------------------->|||
 |||        |                         |            TRUE             |||
 |||        |                         |                             |||
 |||        |       [IP_M_R1]PUT /3311/0/5851 ?gp=1                 |||
 |||<---------------------------------------------------------------|||
 |||        |                     50  |                             |||
 |||        |                         |                             |||
 |||        |       [IP_M_R1]PUT /3311/0/5851 ?gp=2                 |||
 |||<-------------------------------------------------------------->|||
 |||        |                     90  |                             |||
 |||        |                         |                             |||
 |||        |                         |                             |||



    Figure 5: Multicast messaging between control unit and luminaires.

   Figure 5 shows a typical sequence of messages that occur.  For,
   simplicity, we only show the messages exchanged with the control
   function in room 1 and luminaires in room 1 though the same exchange
   of messages applies to every room.  Initially, the control function
   in every room observes resource 5500 on the presence sensor in the
   corridor and also the presence sensor in it's own room.  When the
   presence state changes in the corridor, the corridor notifies the
   control function in every room using a sequence of unicast
   notification messages.  Once a controller in the room receives this
   notification, it sends out a multicast message to all luminaires in
   the group (GId = 0).  If presence is then detected in the room, then
   the room controller is notified and the room controller sends a
   multicast message to the window group (GId = 1) to dim-up to 50% and
   wall group (GID = 2) to dim-up to 90%.

   The authorization and key distribution problems that need to be
   addressed in this example are: 1) The authorization server must
   provide AC-KDC tokens to: a) Allow corridor presence sensor to
   communication with all the control functions in rooms attached to the
   corridor; b) Allow the room presence sensor to communicate with the
   control function in the room; c) Allow the room control function to
   communicate with all the luminaires in the room.  The corridor
   presence sensor MUST NOT be authorized to communicate directly with
   the luminaries. 2) The KDC must provide AC-R keys for all the
   authorized communication.





Somaraju, et al.         Expires January 1, 2016               [Page 17]

Internet-Draft Multicast Security for the Lighting Domain      June 2015


6.  Security Considerations

6.1.  Token Verification

   Due to the low latency requirements, token verification needs to be
   done locally and cannot be outsourced to other parties.  For this
   reason self-contained token must be used and the receivers are
   required to follow the steps outlined in Section 7.2 of RFC 7519
   [RFC7519].  This includes the verification of the message
   authentication code protecting the contents of the token and the
   encryption envelope protecting the contained symmetric group key.

6.2.  Token Revocation

   Tokens have a specific lifetime.  Setting the lifetime is a policy
   decision that involves making a trade-off decision.  Allowing a
   longer lifetime increases the need to introduce a mechanism for token
   revocation (e.g., a real-time signal from the KDC/Authorization
   Server to the receivers to blacklist tokens) but lowers the
   communication overhead during normal operation since new tokens need
   to be obtained only from time to time.  Real-time communication with
   the receivers to revoke tokens may not be possible in all cases
   either, particularly when off-line operation is demanded or in small
   networks where the AS or even the KDC is only present during
   commissioning time.

   We therefore recommend to issue short-lived tokens for for dynamic
   scenarios like users accessing the lighting infrastructure of
   buildings using smartphones, tablets and alike to avoid potential
   security problems when tokens are leaked or where authorization
   rights are revoked.  For senders that are statically mounted (like
   traditional light switches) we recommend a longer lifetime since re-
   configurations and token leakage is less likely to happen frequently.

   To limit the authorization rights tokens should contain an audience
   restriction, scoping their use to the intended receivers and to their
   access level.

6.3.  Time

   Senders and receivers are not assumed to be equipped with real-time
   clocks but these devices are still assumed to interact with a time
   server.  The lack of accurate clocks is likely to lead to clock
   drifts and limited ability to check for replays.  For those cases
   where no time server is available, such as in small network
   installations, token verification cannot check for expired tokens and
   hence it might be necessary to fall-back to tokens that do not
   expire.



Somaraju, et al.         Expires January 1, 2016               [Page 18]

Internet-Draft Multicast Security for the Lighting Domain      June 2015


7.  Operational Considerations

7.1.  Persistence of State Information

   Devices in the lighting system can often be powered down
   intentionally or unintentionally.  Therefore the devices may need to
   store the authorization tokens and cryptographic keys (along with
   replay context) in persistence storage like flash.  This is
   especially required if the authorization server is no more online
   since it was removed after the commissioning phase.  However the
   decision on the data to be persistently stored is a trade-off between
   how soon the devices can be back online to normal operational mode
   and the memory wear caused due to limited program-erase cycles of
   flash over 15-20 years life-time of the device.

   The different data that may need to be stored are access tokens AT-
   KDC, AT-R and last seen replay counter.

7.2.  Provisioning in Small Networks

   In small networks the authorization server and the KDC may be
   available only temporarily during the commissioning process and are
   not available afterwards.

8.  Acknowledgements

   The author would like to thank Walter Werner for his help with this
   document.

9.  References

9.1.  Normative References

   [I-D.gerdes-ace-actors]
              Gerdes, S., Seitz, L., Selander, G., and C. Bormann, "An
              architecture for authorization in constrained
              environments", draft-gerdes-ace-actors-05 (work in
              progress), April 2015.

   [IPSO]     IPSO Alliance, "IPSO Smart Object Guidelines - Starter
              Pack 1.0", 2015.

   [LWM2M]    Open Mobile Alliance, "Lightweight Machine-to-Machine,
              Technical Specification, Candidate Version 1.0", December
              2013.

   [RFC7516]  Jones, M. and J. Hildebrand, "JSON Web Encryption (JWE)",
              RFC 7516, May 2015.



Somaraju, et al.         Expires January 1, 2016               [Page 19]

Internet-Draft Multicast Security for the Lighting Domain      June 2015


9.2.  Informative References

   [COSE]     IETF, "CBOR Object Signing and Encryption (cose) Working
              Group", https://datatracker.ietf.org/wg/cose/charter/,
              2015.

   [RFC7049]  Bormann, C. and P. Hoffman, "Concise Binary Object
              Representation (CBOR)", RFC 7049, October 2013.

   [RFC7519]  Jones, M., Bradley, J., and N. Sakimura, "JSON Web Token
              (JWT)", RFC 7519, May 2015.

Authors' Addresses

   Abhinav Somaraju
   Tridonic GmbH & Co KG
   Farbergasse 15
   Dornbirn   6850
   Austria

   Email: abhinav.somaraju@tridonic.com


   Sandeep S. Kumar
   Philips Research
   High Tech Campus 34
   Eindhoven  5656 AE
   NL

   Email: ietf.author@sandeep-kumar.org


   Hannes Tschofenig
   ARM Ltd.
   110 Fulbourn Rd
   Cambridge  CB1 9NJ
   Great Britain

   Email: Hannes.tschofenig@gmx.net
   URI:   http://www.tschofenig.priv.at











Somaraju, et al.         Expires January 1, 2016               [Page 20]
